<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MagStore - Sua Loja Online</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <style>
        :root { --primary: #fff; --secondary: #000; --accent: #f0f0f0; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--primary); color: var(--secondary); }
        .navbar-brand { font-weight: 700; font-size: 1.8rem; }
        .search-box { border-radius: 20px; border: 2px solid var(--secondary); }
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border-radius: 0 0 10px 10px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }
        .search-item { padding: 10px 15px; border-bottom: 1px solid #eee; cursor: pointer; transition: background 0.2s; }
        .search-item:hover { background: #f8f9fa; }
        .search-item:last-child { border-bottom: none; }
        .search-img { width: 40px; height: 40px; object-fit: cover; border-radius: 4px; }
        .carousel-item img { height: 400px; object-fit: cover; }
        .product-card { border: none; border-radius: 10px; transition: transform 0.3s, box-shadow 0.3s; margin-bottom: 20px; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.15); }
        .product-img { height: 200px; object-fit: contain; padding: 15px; background: var(--accent); border-radius: 8px 8px 0 0; }
        .price { font-weight: 700; color: var(--secondary); font-size: 1.2rem; }
        .installment { color: #666; font-size: 0.9rem; }
        .btn-buy { background: var(--secondary); color: var(--primary); border-radius: 20px; padding: 8px 20px; font-weight: 600; transition: all 0.3s; }
        .btn-buy:hover { background: #333; color: var(--primary); transform: scale(1.05); }
        .category-card { border-radius: 10px; background: var(--accent); padding: 15px; text-align: center; transition: all 0.3s; cursor: pointer; }
        .category-card:hover { background: #e0e0e0; transform: translateY(-5px); }
        .category-card.active { background: var(--secondary); color: white; transform: translateY(-5px); }
        .category-card.active i { color: white; }
        .footer { background: var(--secondary); color: var(--primary); margin-top: 40px; }
        .footer a { color: #ddd; text-decoration: none; transition: color 0.3s; }
        .footer a:hover { color: var(--primary); text-decoration: underline; }
        .cart-badge { font-size: 0.6rem; position: absolute; top: 0; right: 0; }
        @media (max-width: 768px) { 
            .carousel-item img { height: 250px; } 
            .navbar-brand { font-size: 1.4rem; }
            .search-results { position: fixed; left: 10px; right: 10px; }
        }
        .filter-tag { 
            background: #e9ecef; 
            border-radius: 20px; 
            padding: 8px 18px; 
            margin: 3px; 
            font-size: 0.9rem; 
            cursor: pointer; 
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        .filter-tag:hover { background: #dee2e6; transform: translateY(-2px); }
        .filter-tag.active { background: var(--secondary); color: white; border-color: var(--secondary); }
        .search-stats { font-size: 0.9rem; color: #666; }
        .section-title { 
            border-bottom: 3px solid var(--secondary); 
            padding-bottom: 10px; 
            margin-bottom: 25px;
            position: relative;
        }
        .section-title::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 50px;
            height: 3px;
            background: var(--secondary);
        }
        .no-products {
            padding: 60px 20px;
            text-align: center;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .filter-active-badge {
            background: var(--secondary);
            color: white;
            border-radius: 20px;
            padding: 5px 15px;
            font-size: 0.85rem;
            display: inline-flex;
            align-items: center;
            margin-left: 10px;
        }
        .filter-active-badge i { cursor: pointer; margin-left: 5px; }
        .product-badge { position: absolute; top: 10px; right: 10px; }
        .loading { display: none; text-align: center; padding: 20px; }
        .loading.active { display: block; }
        .price-old { text-decoration: line-through; color: #999; font-size: 0.9rem; }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-white sticky-top shadow-sm">
        <div class="container">
            <a class="navbar-brand text-dark" href="#" onclick="resetFilters()"><i class="bi bi-shop"></i> MagStore</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarContent">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item"><a class="nav-link text-dark" href="#" onclick="resetFilters()">Home</a></li>
                    <li class="nav-item"><a class="nav-link text-dark" href="#products" onclick="scrollToSection('products')">Produtos</a></li>
                    <li class="nav-item"><a class="nav-link text-dark" href="#categories" onclick="scrollToSection('categories')">Categorias</a></li>
                    <li class="nav-item"><a class="nav-link text-dark" href="#offers" onclick="scrollToSection('offers')">Ofertas</a></li>
                </ul>
                <div class="d-flex align-items-center">
                    <!-- Barra de Busca -->
                    <div class="position-relative me-3" style="width: 300px;">
                        <div class="input-group search-box">
                            <input type="text" id="searchInput" class="form-control border-0" placeholder="Buscar produtos..." autocomplete="off">
                            <span class="input-group-text bg-transparent border-0">
                                <i class="bi bi-search"></i>
                            </span>
                        </div>
                        <div id="searchResults" class="search-results"></div>
                    </div>
                    
                    <div class="position-relative me-3">
                        <a href="#" class="text-dark fs-5" data-bs-toggle="modal" data-bs-target="#cartModal">
                            <i class="bi bi-cart3"></i>
                        </a>
                        <span class="cart-badge badge bg-dark rounded-pill" id="cartCount">3</span>
                    </div>
                    <a href="#" class="text-dark fs-5" onclick="goToProfile(); return false;"><i class="bi bi-person-circle"></i></a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Carousel -->
    <div id="bannerCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
        <div class="carousel-inner">
            <div class="carousel-item active">
                <img loading="lazy" src="https://images.unsplash.com/photo-1607082348824-0a96f2a4b9da?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80" class="d-block w-100" alt="Ofertas">
                <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-3">
                    <h5>Ofertas Especiais</h5>
                    <p>Até 50% de desconto em eletrônicos</p>
                </div>
            </div>
            <div class="carousel-item">
                <img loading="lazy" src="https://images.unsplash.com/photo-1556656793-08538906a9f8?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80" class="d-block w-100" alt="Black Friday">
                <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-3">
                    <h5>Black Friday Antecipada</h5>
                    <p>Os melhores preços você encontra aqui</p>
                </div>
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#bannerCarousel" data-bs-slide="prev">
            <span class="carousel-control-prev-icon"></span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#bannerCarousel" data-bs-slide="next">
            <span class="carousel-control-next-icon"></span>
        </button>
    </div>

    <div class="container">
        <!-- Filtros Rápidos e Indicador de Filtro Ativo -->
        <div class="mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h4 class="mb-0">Filtrar Produtos</h4>
                <div id="activeFilterIndicator" class="d-none">
                    <span class="filter-active-badge">
                        Filtro: <span id="activeFilterName"></span>
                        <i class="bi bi-x" onclick="resetFilters()"></i>
                    </span>
                </div>
            </div>
            
            <div class="mb-2">
                <span class="me-3">Categorias:</span>
                <div class="d-flex flex-wrap">
                    <span class="filter-tag active" data-filter="all" onclick="applyFilter('all')">Todos</span>
                    <span class="filter-tag" data-filter="Informática" onclick="applyFilter('Informática')">Informática</span>
                    <span class="filter-tag" data-filter="Celulares" onclick="applyFilter('Celulares')">Celulares</span>
                    <span class="filter-tag" data-filter="TV e Vídeo" onclick="applyFilter('TV e Vídeo')">TV e Vídeo</span>
                    <span class="filter-tag" data-filter="Eletrodomésticos" onclick="applyFilter('Eletrodomésticos')">Eletrodomésticos</span>
                    <span class="filter-tag" data-filter="Acessórios" onclick="applyFilter('Acessórios')">Acessórios</span>
                    <span class="filter-tag" data-filter="Games" onclick="applyFilter('Games')">Games</span>
                </div>
            </div>
            
            <div id="searchStats" class="search-stats"></div>
            <div id="loading" class="loading">
                <div class="spinner-border spinner-border-sm text-dark" role="status">
                    <span class="visually-hidden">Carregando...</span>
                </div>
                <span class="ms-2">Filtrando produtos...</span>
            </div>
        </div>

        <!-- Categorias -->
        <section id="categories" class="mb-5">
            <h3 class="section-title">Categorias em Destaque</h3>
            <div class="row g-3">
                <div class="col-6 col-md-3">
                    <div class="category-card" onclick="applyFilter('Informática')">
                        <i class="bi bi-laptop fs-1 mb-2"></i>
                        <h6>Informática</h6>
                        <small class="text-muted">Notebooks, PCs, Monitores</small>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="category-card" onclick="applyFilter('Celulares')">
                        <i class="bi bi-phone fs-1 mb-2"></i>
                        <h6>Celulares</h6>
                        <small class="text-muted">Smartphones, Tablets</small>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="category-card" onclick="applyFilter('TV e Vídeo')">
                        <i class="bi bi-tv fs-1 mb-2"></i>
                        <h6>TV e Vídeo</h6>
                        <small class="text-muted">TVs, Home Theater</small>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="category-card" onclick="applyFilter('Eletrodomésticos')">
                        <i class="bi bi-house-door fs-1 mb-2"></i>
                        <h6>Eletrodomésticos</h6>
                        <small class="text-muted">Geladeiras, Fogões</small>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="category-card" onclick="applyFilter('Acessórios')">
                        <i class="bi bi-headphones fs-1 mb-2"></i>
                        <h6>Acessórios</h6>
                        <small class="text-muted">Fones, Mouses, Teclados</small>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="category-card" onclick="applyFilter('Games')">
                        <i class="bi bi-controller fs-1 mb-2"></i>
                        <h6>Games</h6>
                        <small class="text-muted">Consoles, Jogos, Acessórios</small>
                    </div>
                </div>
            </div>
        </section>

        <!-- Produtos -->
        <section id="products" class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="section-title mb-0">Produtos em Destaque</h3>
                <a href="#" class="text-dark" onclick="resetFilters()">
                    Limpar filtros <i class="bi bi-arrow-counterclockwise"></i>
                </a>
            </div>
            <div class="row" id="productList">
                <!-- Produtos serão carregados dinamicamente -->
            </div>
        </section>

        <!-- Ofertas -->
        <section id="offers" class="mb-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h3 class="section-title mb-0">Ofertas do Dia</h3>
                <div class="countdown text-dark">
                    <i class="bi bi-clock"></i> Termina em: <span id="countdownTimer">23:59:59</span>
                </div>
            </div>
            <div class="row" id="offerList">
                <!-- Ofertas serão carregadas dinamicamente -->
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="footer py-4">
        <div class="container">
            <div class="row">
                <div class="col-md-3 mb-3">
                    <h5><i class="bi bi-shop"></i> MagStore</h5>
                    <p class="small">A melhor experiência em compras online.</p>
                </div>
                <div class="col-md-3 mb-3">
                    <h6>Institucional</h6>
                    <ul class="list-unstyled small">
                        <li><a href="#">Sobre nós</a></li>
                        <li><a href="#">Nossas Lojas</a></li>
                        <li><a href="#">Política de Privacidade</a></li>
                    </ul>
                </div>
                <div class="col-md-3 mb-3">
                    <h6>Atendimento</h6>
                    <ul class="list-unstyled small">
                        <li><a href="#">Central de Ajuda</a></li>
                        <li><a href="#">Meus Pedidos</a></li>
                        <li><a href="#">Fale Conosco</a></li>
                    </ul>
                </div>
                <div class="col-md-3 mb-3">
                    <h6>Siga-nos</h6>
                    <div class="d-flex gap-3">
                        <a href="#"><i class="bi bi-facebook fs-5"></i></a>
                        <a href="#"><i class="bi bi-instagram fs-5"></i></a>
                        <a href="#"><i class="bi bi-twitter fs-5"></i></a>
                    </div>
                </div>
            </div>
            <hr class="my-4">
            <div class="text-center small"><p>&copy; 2023 MagStore. Todos os direitos reservados.</p></div>
        </div>
    </footer>

    <!-- Modal Carrinho -->
    <div class="modal fade" id="cartModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title"><i class="bi bi-cart3"></i> Meu Carrinho</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div id="cartItems" class="mb-3"></div>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h5>Total: <span id="cartTotal">R$ 0,00</span></h5>
                        <button class="btn btn-dark btn-buy" onclick="finalizePurchase()">Finalizar Compra</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Dados dos produtos
        const products = [
            {id:1,name:"Notebook Gamer Acer Nitro 5",price:4299.99,image:"https://images.unsplash.com/photo-1603302576837-37561b2e2302?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",category:"Informática",installments:10,tags:["notebook","gamer","acer","intel i5","gtx 1650"]},
            {id:2,name:"Smartphone Samsung Galaxy S21 128GB",price:1899.99,image:"https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",category:"Celulares",installments:8,tags:["celular","samsung","galaxy","android","128gb"]},
            {id:3,name:"Smart TV LG 50\" 4K UHD",price:2499.99,image:"https://images.unsplash.com/photo-1593359677879-a4bb92f829d1?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",category:"TV e Vídeo",installments:12,tags:["tv","smart tv","lg","4k","50 polegadas"]},
            {id:4,name:"Geladeira Brastemp Frost Free 375L",price:3199.99,image:"https://images.unsplash.com/photo-1571175443880-49e1d1b7b1e4?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",category:"Eletrodomésticos",installments:10,tags:["geladeira","brastemp","frost free","inverter","375 litros"]},
            {id:5,name:"Fone Bluetooth Sony WH-1000XM4",price:299.99,image:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",category:"Acessórios",installments:3,tags:["fone","bluetooth","sony","cancelamento de ruído"]},
            {id:6,name:"Console PlayStation 5 825GB",price:3499.99,image:"https://images.unsplash.com/photo-1606144042614-b2417e99c4e3?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",category:"Games",installments:12,tags:["playstation","ps5","console","sony","825gb"]},
            {id:7,name:"Monitor Gamer 27\" 144Hz",price:1599.99,image:"https://images.unsplash.com/photo-1593640408182-31c70c8268f5?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",category:"Informática",installments:6,tags:["monitor","gamer","144hz","27 polegadas","full hd"]},
            {id:8,name:"Tablet Samsung Galaxy Tab S7",price:2199.99,image:"https://images.unsplash.com/photo-1546054450-2a4474c7d46d?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",category:"Informática",installments:8,tags:["tablet","samsung","android","128gb"]},
            {id:9,name:"Air Fryer Mondial 4,2L",price:499.99,image:"https://images.unsplash.com/photo-1551698618-1dfe5d97d256?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",category:"Eletrodomésticos",installments:5,tags:["air fryer","fritadeira","elétrica","mondial"]},
            {id:10,name:"Smartphone iPhone 13 128GB",price:3999.99,image:"https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",category:"Celulares",installments:12,tags:["iphone","apple","ios","128gb"]},
            {id:11,name:"Soundbar Samsung 2.1 Canais",price:899.99,image:"https://images.unsplash.com/photo-1546435770-a3e426bf472b?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",category:"TV e Vídeo",installments:6,tags:["soundbar","samsung","áudio","2.1"]},
            {id:12,name:"Mouse Gamer Razer DeathAdder",price:299.99,image:"https://images.unsplash.com/photo-1527814050087-3793815479db?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",category:"Acessórios",installments:3,tags:["mouse","gamer","razer","rgb"]},
            {id:13,name:"Teclado Mecânico Redragon",price:349.99,image:"https://images.unsplash.com/photo-1541140532154-b024d705b90a?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",category:"Acessórios",installments:3,tags:["teclado","mecânico","redragon","rgb"]},
            {id:14,name:"Nintendo Switch 32GB",price:2299.99,image:"https://images.unsplash.com/photo-1578303512597-81e6cc155b3e?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80",category:"Games",installments:8,tags:["nintendo","switch","console","games"]}
        ];

        let cart = [
            {id:2,name:"Smartphone Samsung Galaxy S21 128GB",price:1899.99,quantity:1,image:"https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80"},
            {id:5,name:"Fone Bluetooth Sony WH-1000XM4",price:299.99,quantity:2,image:"https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=500&q=80"}
        ];

        // Estado da aplicação
        let activeFilter = "all";
        let currentSearchTerm = "";
        let filteredProducts = [];

        // Funções básicas
        const formatter = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });
        const formatPrice = p => formatter.format(p);
        const cartTotal = () => cart.reduce((t,i) => t + (i.price * i.quantity), 0);
        const updateCartCount = () => document.getElementById('cartCount').textContent = cart.reduce((s,i) => s + i.quantity, 0);

        // Aplicar filtro
        const applyFilter = (filterName) => {
            showLoading();
            
            // Atualizar estado
            activeFilter = filterName;
            
            // Atualizar UI dos filtros
            document.querySelectorAll('.filter-tag').forEach(tag => {
                tag.classList.remove('active');
                if (tag.dataset.filter === filterName) {
                    tag.classList.add('active');
                }
            });
            
            // Atualizar UI das categorias
            document.querySelectorAll('.category-card').forEach(card => {
                card.classList.remove('active');
                const categoryName = card.querySelector('h6').textContent;
                if (categoryName === filterName) {
                    card.classList.add('active');
                }
            });
            
            // Atualizar indicador de filtro ativo
            const indicator = document.getElementById('activeFilterIndicator');
            if (filterName === "all") {
                indicator.classList.add('d-none');
            } else {
                indicator.classList.remove('d-none');
                document.getElementById('activeFilterName').textContent = filterName;
            }
            
            // Filtrar produtos com delay para simular carregamento
            setTimeout(() => {
                filterProducts();
                hideLoading();
            }, 300);
        };

        // Mostrar/ocultar loading
        const showLoading = () => document.getElementById('loading').classList.add('active');
        const hideLoading = () => document.getElementById('loading').classList.remove('active');

        // Filtrar produtos
        const filterProducts = () => {
            // Primeiro filtrar por categoria
            if (activeFilter === "all") {
                filteredProducts = [...products];
            } else {
                filteredProducts = products.filter(p => p.category === activeFilter);
            }
            
            // Depois filtrar por termo de busca
            if (currentSearchTerm.trim() !== "") {
                const term = currentSearchTerm.toLowerCase().trim();
                filteredProducts = filteredProducts.filter(product => {
                    const nameMatch = product.name.toLowerCase().includes(term);
                    const categorySearch = product.category.toLowerCase().includes(term);
                    const tagMatch = product.tags.some(tag => tag.toLowerCase().includes(term));
                    return nameMatch || categorySearch || tagMatch;
                });
            }
            
            // Atualizar estatísticas
            updateStats();
            
            // Renderizar produtos
            renderProducts();
            
            // Esconder resultados da busca flutuante
            document.getElementById('searchResults').style.display = 'none';
        };

        // Atualizar estatísticas
        const updateStats = () => {
            const stats = document.getElementById('searchStats');
            let statsText = "";
            
            if (currentSearchTerm.trim() !== "" && activeFilter !== "all") {
                statsText = `<i class="bi bi-funnel"></i> ${filteredProducts.length} produto(s) encontrado(s) para "${currentSearchTerm}" na categoria "${activeFilter}"`;
            } else if (currentSearchTerm.trim() !== "") {
                statsText = `<i class="bi bi-search"></i> ${filteredProducts.length} produto(s) encontrado(s) para "${currentSearchTerm}"`;
            } else if (activeFilter !== "all") {
                statsText = `<i class="bi bi-funnel"></i> ${filteredProducts.length} produto(s) na categoria "${activeFilter}"`;
            } else {
                statsText = "";
            }
            
            stats.innerHTML = statsText;
        };

        // Renderizar produtos
        const renderProducts = () => {
            const productList = document.getElementById('productList');
            const offerList = document.getElementById('offerList');
            
            // Limpar listas
            productList.innerHTML = '';
            offerList.innerHTML = '';
            
            // Se não há produtos filtrados
            if (filteredProducts.length === 0) {
                productList.innerHTML = `
                    <div class="col-12">
                        <div class="no-products">
                            <i class="bi bi-search fs-1 text-muted"></i>
                            <h4 class="mt-3">Nenhum produto encontrado</h4>
                            <p class="text-muted">Tente ajustar seus filtros ou termos de busca</p>
                            <button class="btn btn-dark mt-2" onclick="resetFilters()">
                                <i class="bi bi-arrow-counterclockwise"></i> Limpar filtros
                            </button>
                        </div>
                    </div>
                `;
                return;
            }
            
            // Determinar quais produtos mostrar
            let productsToShow = [];
            let offersToShow = [];
            
            if (activeFilter !== "all" || currentSearchTerm.trim() !== "") {
                // Mostrar todos os produtos filtrados na seção principal
                productsToShow = filteredProducts;
                // Esconder seção de ofertas quando filtro está ativo
                document.getElementById('offers').style.display = 'none';
            } else {
                // Modo normal: produtos em destaque + ofertas
                productsToShow = filteredProducts.slice(0, 8);
                offersToShow = filteredProducts.slice(8, 14).map(p => ({...p, originalPrice: p.price}));
                document.getElementById('offers').style.display = 'block';
            }
            
            // Renderizar produtos (agrupar strings para reduzir reflows)
            let productsHtml = '';
            productsToShow.forEach(p => {
                productsHtml += `
                <div class="col-md-3 col-6">
                    <div class="card product-card h-100">
                        <img loading="lazy" src="${p.image}" class="card-img-top product-img" alt="${p.name}">
                        <div class="card-body d-flex flex-column">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="card-title mb-0" style="font-size: 0.95rem;">${p.name}</h6>
                                <span class="badge bg-dark">${p.category}</span>
                            </div>
                            <p class="price mb-1">${formatPrice(p.price)}</p>
                            <p class="installment mb-3">${p.installments}x de ${formatPrice(p.price/p.installments)}</p>
                            <button class="btn btn-buy mt-auto" onclick="addToCart(event, ${p.id})">
                                <i class="bi bi-cart-plus"></i> Comprar
                            </button>
                        </div>
                    </div>
                </div>`;
            });
            productList.innerHTML = productsHtml;

            // Renderizar ofertas (apenas se não estiver filtrando)
            if (offersToShow.length > 0) {
                let offersHtml = '';
                offersToShow.forEach(p => {
                    const discountPrice = p.price * 0.8;
                    offersHtml += `
                    <div class="col-md-3 col-6">
                        <div class="card product-card h-100 border border-danger">
                            <span class="position-absolute top-0 start-0 bg-danger text-white small px-2 py-1">-20%</span>
                            <img loading="lazy" src="${p.image}" class="card-img-top product-img" alt="${p.name}">
                            <div class="card-body d-flex flex-column">
                                <div class="d-flex justify-content-between align-items-start mb-2">
                                    <h6 class="card-title mb-0" style="font-size: 0.95rem;">${p.name}</h6>
                                    <span class="badge bg-dark">${p.category}</span>
                                </div>
                                <p class="price-old mb-1">${formatPrice(p.originalPrice || p.price)}</p>
                                <p class="price mb-1">${formatPrice(discountPrice)}</p>
                                <p class="installment mb-3">${p.installments}x de ${formatPrice(discountPrice/p.installments)}</p>
                                <button class="btn btn-buy mt-auto" onclick="addToCart(event, ${p.id}, true)">
                                    <i class="bi bi-cart-plus"></i> Comprar
                                </button>
                            </div>
                        </div>
                    </div>`;
                });
                offerList.innerHTML = offersHtml;
            } else {
                offerList.innerHTML = '';
            }
        };

        // Resetar todos os filtros
        const resetFilters = () => {
            applyFilter('all');
            document.getElementById('searchInput').value = '';
            currentSearchTerm = '';
            document.getElementById('searchStats').innerHTML = '';
        };

        // Busca em tempo real
        const handleSearch = (term) => {
            currentSearchTerm = term.trim();
            
            // Mostrar/atualizar resultados flutuantes para busca rápida
            if (currentSearchTerm.length > 0) {
                renderQuickSearchResults(currentSearchTerm);
            } else {
                document.getElementById('searchResults').style.display = 'none';
            }
            
            // Filtrar produtos principalmente apenas se houver termo ou filtro ativo
            if (currentSearchTerm.length > 0 || activeFilter !== "all") {
                filterProducts();
            }
        };

        // Renderizar resultados rápidos da busca
        const renderQuickSearchResults = (term) => {
            if (!term || term.length === 0) {
                document.getElementById('searchResults').style.display = 'none';
                return;
            }
            
            const searchResults = document.getElementById('searchResults');
            const searchLower = term.toLowerCase();
            
            const results = products.filter(product => {
                const nameMatch = product.name.toLowerCase().includes(searchLower);
                const categoryMatch = product.category.toLowerCase().includes(searchLower);
                const tagMatch = product.tags.some(tag => tag.toLowerCase().includes(searchLower));
                return nameMatch || categoryMatch || tagMatch;
            });

            if (results.length === 0) {
                searchResults.innerHTML = `
                    <div class="search-item p-3 text-center">
                        <i class="bi bi-search fs-4 text-muted"></i>
                        <p class="mb-0 mt-2">Nenhum produto encontrado para "${term}"</p>
                    </div>
                `;
                searchResults.style.display = 'block';
                return;
            }

            const header = `<div class="search-item p-3 border-bottom"><small class="text-muted"><strong>${results.length}</strong> resultado(s) encontrado(s)</small></div>`;

            const items = results.slice(0, 5).map(product => `
                <div class="search-item" onclick="selectProduct(${product.id})">
                    <div class="d-flex align-items-center">
                        <img loading="lazy" src="${product.image}" class="search-img me-3" alt="${product.name}">
                        <div class="flex-grow-1">
                            <div class="fw-medium">${product.name}</div>
                            <div class="small text-muted">${product.category}</div>
                            <div class="price small">${formatPrice(product.price)}</div>
                        </div>
                    </div>
                </div>
            `).join('');

            const footer = results.length > 5 ? `<div class="search-item p-3 text-center border-top"><small class="text-muted">Mostrando 5 de ${results.length} resultados</small></div>` : '';

            searchResults.innerHTML = header + items + footer;
            searchResults.style.display = 'block';
        };

        // Selecionar produto da busca rápida
        const selectProduct = (id) => {
            const product = products.find(p => p.id === id);
            if (product) {
                applyFilter(product.category);
                document.getElementById('searchInput').value = product.name;
                currentSearchTerm = product.name;
                filterProducts();
            }
        };

        // Adicionar ao carrinho
        const addToCart = (event, id, offer = false) => {
            const p = products.find(p => p.id === id);
            if (!p) return;

            const item = cart.find(i => i.id === id);
            const price = offer ? p.price * 0.8 : p.price;

            if (item) {
                item.quantity++;
                item.price = price; // Atualiza preço se for oferta
            } else {
                cart.push({id:p.id, name:p.name, price:price, quantity:1, image:p.image});
            }

            updateCartCount();

            // Feedback visual: use o event para localizar o botão com segurança
            let btn = null;
            if (event && event.currentTarget) btn = event.currentTarget;
            if (!btn && event && event.target) btn = event.target.closest('.btn-buy');
            if (btn) {
                const originalHTML = btn.innerHTML;
                btn.innerHTML = '<i class="bi bi-check"></i> Adicionado!';
                btn.classList.add('btn-success');
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                    btn.classList.remove('btn-success');
                }, 1500);
            }
        };

        // Renderizar carrinho
        const renderCart = () => {
            const cartItems = document.getElementById('cartItems');
            const cartTotalEl = document.getElementById('cartTotal');
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p class="text-center">Seu carrinho está vazio</p>';
                cartTotalEl.textContent = formatPrice(0);
                return;
            }
            
            cartItems.innerHTML = cart.map(i => `
            <div class="d-flex align-items-center border-bottom pb-3 mb-3">
                <img src="${i.image}" class="rounded" width="80" height="80" alt="${i.name}">
                <div class="ms-3 flex-grow-1"><h6>${i.name}</h6>
                    <div class="d-flex justify-content-between">
                        <div><span class="price">${formatPrice(i.price)}</span><span class="ms-3">Qtd: ${i.quantity}</span></div>
                        <div>
                            <button class="btn btn-sm btn-outline-dark" onclick="updateQuantity(${i.id}, -1)"><i class="bi bi-dash"></i></button>
                            <button class="btn btn-sm btn-outline-dark ms-1" onclick="updateQuantity(${i.id}, 1)"><i class="bi bi-plus"></i></button>
                            <button class="btn btn-sm btn-danger ms-1" onclick="removeFromCart(${i.id})"><i class="bi bi-trash"></i></button>
                        </div>
                    </div>
                </div>
            </div>`).join('');
            
            cartTotalEl.textContent = formatPrice(cartTotal());
        };

        // Atualizar quantidade
        const updateQuantity = (id, change) => {
            const item = cart.find(i => i.id === id);
            if (!item) return;
            
            item.quantity += change;
            if (item.quantity <= 0) cart = cart.filter(i => i.id !== id);
            
            updateCartCount();
            renderCart();
        };

        // Remover do carrinho
        const removeFromCart = id => {
            cart = cart.filter(i => i.id !== id);
            updateCartCount();
            renderCart();
        };

        // Finalizar compra
        const finalizePurchase = () => {
            if (cart.length === 0) {
                alert('Seu carrinho está vazio!');
                return;
            }
            
            const total = cartTotal();
            const modal = bootstrap.Modal.getInstance(document.getElementById('cartModal'));
            
            alert(`Compra finalizada com sucesso!\nTotal: ${formatPrice(total)}\nObrigado por comprar na MagStore!`);
            
            // Limpar carrinho após compra
            cart = [];
            updateCartCount();
            renderCart();
            
            if (modal) modal.hide();
        };

        // Contador regressivo
        const updateCountdown = () => {
            const now = new Date();
            const end = new Date(); 
            end.setHours(23, 59, 59, 999);
            
            const diff = end - now;
            const h = Math.floor(diff/(1000*60*60));
            const m = Math.floor((diff%(1000*60*60))/(1000*60));
            const s = Math.floor((diff%(1000*60))/1000);
            
            document.getElementById('countdownTimer').textContent = 
                `${h.toString().padStart(2,'0')}:${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
        };

        // Função genérica para scroll
        const scrollToSection = (sectionId) => {
            document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth' });
        };

        // Ir para página de perfil
        const goToProfile = () => {
            window.location.href = 'profile.html';
        };

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            // Inicializar com todos os produtos
            filteredProducts = [...products];
            renderProducts();
            updateCartCount();
            renderCart();
            updateCountdown();
            setInterval(updateCountdown, 1000);
            
            // Configurar busca
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');
            
            // Busca em tempo real com debounce
            let searchTimeout;
            searchInput.addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                const value = e.target.value.trim();
                
                searchTimeout = setTimeout(() => {
                    handleSearch(value);
                }, 200);
            });
            
            // Permitir busca imediata quando digita
            searchInput.addEventListener('keyup', (e) => {
                const value = e.target.value.trim();
                if (value.length > 0) {
                    renderQuickSearchResults(value);
                } else {
                    searchResults.style.display = 'none';
                }
            });
            
            // Fechar resultados ao clicar fora
            document.addEventListener('click', (e) => {
                const searchContainer = document.querySelector('.position-relative.me-3[style*="width"]');
                if (!searchContainer || !searchContainer.contains(e.target)) {
                    searchResults.style.display = 'none';
                }
            });
            
            // Configurar modal do carrinho
            document.getElementById('cartModal').addEventListener('show.bs.modal', renderCart);
            
            // Limpar busca ao pressionar Escape
            searchInput.addEventListener('keydown', (e) => {
                if (e.key === 'Escape') {
                    searchInput.value = '';
                    searchResults.style.display = 'none';
                    resetFilters();
                }
            });
            
            // Inicializar com filtro "todos"
            applyFilter('all');
        });
    </script>
</body>
</html>